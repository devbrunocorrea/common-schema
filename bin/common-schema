#!/usr/bin/env php
<?php

/*
 * This file is part of gpupo/common-schema
 * Created by Gilmar Pupo <contact@gpupo.com>
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 * For more information, see <https://opensource.gpupo.com/>.
 */

namespace Gpupo\CommonSchema\Console;

require 'vendor/autoload.php';

use Symfony\Component\Console\Application;
use Symfony\Component\Dotenv\Dotenv;
use Symfony\Component\Filesystem\Filesystem;
use Symfony\Component\Filesystem\Exception\IOExceptionInterface;

$fileSystem = new Filesystem();

$root = getcwd();
$lib = dirname(dirname( __FILE__ ));

$options = [
    'rootPath'  => $root,
    'libPath' => $lib,
    'env' => $lib.'/.env.dist',
    'customEnv' => $root.'/.env',
];

if(!$fileSystem->exists($options['customEnv'])) {
    $fileSystem->copy($options['env'], $options['customEnv']);
}

$dotenv = new Dotenv();
$dotenv->load($options['env'], $options['customEnv']);

$raiseCommand = new \Gpupo\CommonSchema\Console\Command\RaiseCommand();
$raiseCommand->setOptions($options);

$application = new Application('common-schema');
$application->add(new \Gpupo\CommonSchema\Console\Command\MetadataCommand());
$application->add($raiseCommand);
$application->run();
